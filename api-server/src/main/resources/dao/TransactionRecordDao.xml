<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bookkeeping.dao.TransactionRecordDao">
    <select id="selectWeekData" resultType="com.bookkeeping.entity.vo.CycleBarVO">
        SELECT SUBSTRING(DAYNAME(transaction_date), 1, 3) AS `date`,
            SUM(amount) AS amount
        FROM
            transaction_record
        WHERE
            transaction_date >= CURDATE() - INTERVAL 7 DAY
            AND user_id = #{userId}
        GROUP BY
            transaction_date
        ORDER BY
            transaction_date DESC;
    </select>

    <select id="selectMonthData" resultType="com.bookkeeping.entity.vo.CycleBarVO">
        SELECT
            DAY(transaction_date) AS `date`, SUM(amount) AS amount
        FROM
            transaction_record
        WHERE
            transaction_date >= DATE_FORMAT(CURDATE()
            , '%Y-%m-01')
          AND user_id = #{userId}
        GROUP BY
            DAY (transaction_date)
        ORDER BY
            `date` ASC;
    </select>

    <select id="selectYearData" resultType="com.bookkeeping.entity.vo.CycleBarVO">
        SELECT
            DATE_FORMAT(transaction_date, '%b') AS `date`,
            SUM(amount) AS amount
        FROM
            transaction_record
        WHERE
            YEAR(transaction_date) = YEAR(CURDATE())
            AND user_id = #{userId}
        GROUP BY
            DATE_FORMAT(transaction_date, '%b')
        ORDER BY
            `date` ASC;
    </select>

    <select id="getSpendingTotalAmount" resultType="java.lang.Long">
        SELECT SUM(amount)
        FROM transaction_record
        WHERE user_id = #{userId}
          AND transaction_date BETWEEN #{startDate} AND #{endDate}
    </select>
</mapper>